<html>
<head>
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.8/angular.min.js"></script>
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.8/angular-resource.min.js"></script>
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">

  <!-- Optional theme -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">

  <script type="text/javascript" src="dist/moback.js"></script>
  <title>Moback Test Page</title>
</head>
<body>
<div ng-app="Test">
  <div ng-controller="mobackTesterCtrl">
    <h1>Moback Object Relation Manager Functions</h1>
    <button ng-click="createObject1()">create object 1</button>
    <button ng-click="create2Objects()">create 2 objects</button>
    <button ng-click="linkObject()">link obj2 to obj 1</button>
    <button ng-click="getObject2()">get object 2 with parent</button>
    <br>
    <button ng-click="testAddRelation()">assign cars to vendor</button>
    <button ng-click="testRemoveRelation()">remove cars fomr vendor</button>
    <br>
    <p ng-cloak="">{{ output }}</p>
  </div>
</div>
<script>


  angular.module('Test', ['ngResource']).controller('mobackTesterCtrl', function ($scope ) {

    /*after creating an app in moback, grab the app key, and dev key*/
    Moback.initialize("MDMzZGQxMWUtNDFiYy00YTkyLWJkMTMtNDk0YjZhYzg1NThk","NDczMjI5NWQtNjhkMi00ZDcwLWE4YzItYTQ2YzI2ZWI1YTMy");

    var mobackCommentQuery = new Moback.queryMgr('comment');
    var mobackCarsQuery = new Moback.queryMgr('cars');
    var mobackVendorQuery = new Moback.queryMgr('vendor');
    window.obj1 = {};
    window.obj2 = {};

    $scope.createObject1 = function() {
      /*create an object
       * row obj, table, callback function
       * on the callback, calling a get object detail afterwards
       * */

      obj1 = new Moback.objMgr('post');
      obj1.set("title", "oscar posts");
      obj1.save(function(data){
        $scope.output = data;
        console.log(data);
        $scope.$apply();
      });
    };

    $scope.create2Objects = function() {
      /*create 2 objects and link obj1 with obj2
       * */
      obj1 = new Moback.objMgr('post');
      obj1.set("title", "golden globe posts");

      obj2 = new Moback.objMgr('comment');
      obj2.set("content", "best actor to george clooney");
      obj2.set("parent", obj1);

      obj2.save(function(data){
        $scope.output = data;
        console.log(data);
        $scope.$apply();
      });
    };


    $scope.linkObject = function() {
      /*create an object
       * row obj, table, callback function
       * on the callback, calling a get object detail afterwards
       * */
      obj2 = new Moback.objMgr('comment');
      obj2.set("content", "best actor to ben affleck");
      obj2.set("parent", obj1);
      obj2.save(function(data){
        $scope.output = data;
        console.log(data);
        $scope.$apply();
      });
    };


    $scope.getObject2 = function() {
      /*create an object
       * row obj, table, callback function
       * on the callback, calling a get object detail afterwards
       * */
      mobackCommentQuery.fetchSingle('VOuqHeSw7MI5Wyos', function(data){
        obj2 = data;
        obj1 = obj2.get('parent');
        obj1.fetch(function(data){
          $scope.output = data;
          console.log(data);
          $scope.$apply();
        });
      });
    };



    $scope.testAddRelation = function() {
      /* testing adding relations
       * */
      mobackCarsQuery.fetchSingle('VOUESuSwx2_EDDY6', function(data){
        var mobackObj1 = data;
        console.log(data);

        /*
        //use this if you want to add one more
        mobackCarsQuery.fetchSingle('VOYqHeSwx2_EDDaY', function(data) {
          var mobackObj2 = data;
          console.log(data);
          */

          mobackVendorQuery.fetchSingle('VOutQeSw7MI5Wyoy', function(data){
            vendor1 = data;
            console.log(data);

             window.relation = vendor1.relation("cars");
             relation.add(mobackObj1);
             //relation.add(mobackObj2);
             console.log(relation.inspect());


            vendor1.save(function(data){
              console.log(data);
              console.log(relation.inspect());
             });

        });

        $scope.output = data;
        $scope.$apply();
      });
    };

    $scope.testRemoveRelation = function() {
      /* testing removing relations
       * */
      mobackCarsQuery.fetchSingle('VOUESuSwx2_EDDY6', function(data){
        var mobackObj1 = data;
        console.log(data);


        mobackVendorQuery.fetchSingle('VOutQeSw7MI5Wyoy', function(data){
          vendor1 = data;
          console.log(data);


          window.relation = vendor1.relation("cars");
          relation.remove(mobackObj1);
          console.log(relation.inspect());


          vendor1.save(function(data){
            console.log(data);
            console.log(relation.inspect());
          });

        });

        $scope.output = data;
        $scope.$apply();
      });
    };


    $scope.output = "";
  });
</script>

</body>
</html>

